<html>
	<head>
		<link rel="stylesheet" type="text/css" href="/assets/css/main.css">
		<link href="https://fonts.googleapis.com/css2?family=Recursive&display=swap" rel="stylesheet">
		<script src="/socket.io/socket.io.js"></script>
		<script>
			var socket = io();
		</script>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
		<title>Real-time chat application using socket.io</title>
	</head>
	<body>
		<h2 id="header">Chat Application</h2>
		<table id="chat-interface">
			<tr>
				<th id="users-header">Online Users</th>
				<th id="chat-header">User you are texting</th>
			</tr>
			<tr>
				<td id="users">
				</td>
				<td id="chat">
					<div id="messages"></div>
					<div id="chat-footer">
						<input id="chat-box" placeholder="Write your message..." autocomplete="off"></input>
						<input id="send" type="button" value="Send" onclick="send()"></input>
					</div>
				</td>
			</tr>
		</table>
		<div id="nickname-modal">
		</div>
		<script>
			function calcHeight() {
				let headerHeight = document.getElementById('header').offsetHeight;
				let chatInterfaceHeaderHeight = document.getElementById('chat-header').offsetHeight;
				
				let chatInterfaceHeight = window.innerHeight - headerHeight - chatInterfaceHeaderHeight - 25 - 25 - 3;
				document.documentElement.style.setProperty('--cih', `${chatInterfaceHeight}px`);
				
				let chatFooterHeight = document.getElementById('chat-footer').offsetHeight;
				
				let messagesHeight = chatInterfaceHeight - chatFooterHeight - 4;
				document.documentElement.style.setProperty('--mh', `${messagesHeight}px`);
			}
			
			calcHeight();
			window.addEventListener("resize", calcHeight);
			
			function send() {
				let message = document.getElementById('chat-box');
				socket.emit('message', message.value.trim());
				
				if(message.value.trim() != '') {
					let messages = document.getElementById('messages');
					messages.innerHTML = messages.innerHTML + '<div style="width: 100%; text-align: right;"><div class="message" style="background: #fff; color: #000;">' + message.value.trim() + '</div></div>';
				}
				
				message.value = '';
			}
			
			document.getElementById('chat-box').addEventListener("keyup", function(e) {
				if(e.keyCode == 13)
					send();
			});
			
			socket.on('message', (message) => {
				let messages = document.getElementById('messages');
				messages.innerHTML = messages.innerHTML + '<div style="width: 100%; text-align: left;"><div class="message" style="background: #000; color: #fff;">' + message + '</div></div>'
			});
		</script>
	</body>
</html>
